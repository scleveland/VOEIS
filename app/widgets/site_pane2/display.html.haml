:css
  #content { margin:10px 50px }
  #wrapper {
    padding-bottom: 20px;
    background-color: #ccb;
    padding-top: 1px;
  }
  #wrapper img { margin-right:12px }
  #wrapper p { margin:0 20px }

  #site00-sample-table td { text-align:center; }
  #site00-sample-table td.time0 { text-align:left; }

  #form-table { width:600px; }
  #form-table td { width:50%; }
  .form_element { width:20em; }
  
  .dijitTextBox { width:18em !important; }
  .TextBox_name { width:25em !important; }
  
  .new_voeis_site input { width:18em; }
  .new_voeis_site textarea { width:45em; }
  .new_voeis_site select { width:21em; }

  .row-lt1 { background-color:#ddd; }
  .row-gr { background-color: #6AA128; }
  .row-gr { background-color: #97C253; }
  .row-gr { background-color: #97D8AB; }
  .row-gr th { background-color: #97D8AB!important; }
  .row-gr td { background-color: #97D8AB!important; }
  .smfont, .smfont * { font-size:10px }

  #site00_lat_long_picker {
    width: 600px;
    height: 350px;
    padding: 0!important;
  }
  #site00_lat_long_mapdiv {
    width: 585px;
    height: 305px;
    margin: 0!important;
    padding: 0!important;
    xposition: absolute;
    xborder: red solid 3px;
  }
  #site00_lat_long_map_control {
    width: 84px;
    height: 24px;
    margin: 10px 5px;
    background: url('/images/select-button-gold.gif') transparent center no-repeat;
    cursor: pointer;
    
    xposition: relative;
    xposition: absolute;
    xbottom: 50px;
    xright: 50px;
    xz-index: 1;
  }


- content_for(:javascripts) do
  :javascript
    dojo.require("dijit.dijit");
    dojo.require("dijit.Declaration");
    dojo.require("dijit.layout.ContentPane");
    dojo.require("dijit.layout.TabContainer");
    dojo.require("dojox.layout.TableContainer");
    dojo.require("dojox.layout.ContentPane");
    dojo.require("dijit.Dialog");
    dojo.require("dijit.form.Form");
    dojo.require("dijit.form.TextBox");
    dojo.require("dijit.form.Button");
    dojo.require("dijit.form.ValidationTextBox");
    dojo.require("dijit.Tooltip");
    


-# $.post("#{root_url}/vertical_datum.json?vertical_datum[term]="+$("#vertical_datum_term").val()+"&vertical_datum_definition[definition]="+$("#vertical_datum_definition").val(),

-# RENDER CREATE-NEW DIALOGS
-#= render(:partial => "../views/voeis/sites/new_vertical_datum")
-#= render(:partial => "../views/voeis/sites/new_local_projection")


%h3{:id=>"site00-name-head", :style=>"margin:0 0 16px 0;padding:0;"}
  $$$site-name$$$

-#-if !current_user.nil? && current_user.projects.include?(@project)
-#  = link_to('Edit', edit_project_site_path(@project,@site.id), :class=>'icon icon-edit')
-#  &nbsp;&nbsp;&nbsp;
-#= link_to('Cancel', project_path(@project), :class => 'icon icon-cancel') 
-#%br

#show-site00{:style=>"margin-top:0;padding-top:0;"}
  %strong SHOW SITE DETAILS
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  -if @edit_auth
    -#= link_to('DATA QUERY QA/QC', 'javascript:', :class=>'icon icon-proj', :onclick=>"dojo.publish('voeis/project/dataquery', [$$$id$$$]);")
    = link_to('DATA QUERY QA/QC', 'javascript:', :class=>'icon icon-proj', :onclick=>"$('#show-site00').hide();$('#query-site00').show();return false;")
  -else
    -#= link_to('DATA QUERY', 'javascript:', :class=>'icon icon-proj', :onclick=>"dojo.publish('voeis/project/dataquery', [$$$id$$$]);")
    = link_to('DATA QUERY', 'javascript:', :class=>'icon icon-proj', :onclick=>"$('#show-site00').hide();$('#query-site00').show();return false;")
  -if @auth
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    = link_to('EDIT', 'javascript:', :class=>'icon icon-edit', :onclick=>"$('#show-site00').hide();$('#edit-site00').show();")
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    = link_to('DELETE', 'javascript:', :class=>'icon icon-delete', :onclick=>"delete_site($$$id$$$);")
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  = link_to('HISTORY', 'javascript:', :class=>'icon icon-hist', :onclick=>"dojo.publish('voeis/project/site/history', [$$$id$$$]);")

  -#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  -#= link_to('SAMPLES', 'javascript:', :class=>'icon icon-proj', :onclick=>"dojo.publish('voeis/project/site/history', [$$$id$$$]);")
  %br
  
  -#%table{:style=>"width:90%;"}
  -#  %tr
  -#    %td{:style=>"width:160px!important;"}
  -#      %strong SHOW SITE DETAILS
  -#    -if @auth
  -#      %td{:style=>"width:100px!important;"}
  -#        -#= link_to('CANCEL', project_path(@project), :class => 'icon icon-cancel') 
  -#        -#= link_to('CANCEL', '#', :class=>'icon icon-cancel', :onclick=>'window.history.back();return false;') 
  -#        -#-if !@current_user.nil? && @current_user.projects.include?(@project)
  -#        &nbsp;&nbsp;&nbsp;
  -#        -#= link_to('EDIT', 'javascript:', :class=>'icon icon-edit', :onclick=>"init_site_form($$$id$$$);$('#show-site00').hide();$('#edit-site00').show();")
  -#        = link_to('EDIT', 'javascript:', :class=>'icon icon-edit', :onclick=>"$('#show-site00').hide();$('#edit-site00').show();")
  -#        -#%br
  -#        -#&nbsp;&nbsp;&nbsp;
  -#        -#= link_to('TEST', 'javascript:', :class=>'icon icon-edit', :onclick=>"alert('EDIT>>> '+site_pane2.editMode);") 
  -#      %td{:style=>"width:100px!important;"}
  -#        = link_to('HISTORY', 'javascript:', :class=>'icon icon-hist', :onclick=>"dojo.publish('voeis/project/site/history', [$$$id$$$]);")
  
  %br

  %table{:id=>"site00-property-table", :style=>"width:46%;margin-right:20px;margin-bottom:30px;float:left;"}
    - @site_properties.each do |prop|
      %tr{:class=>"row#{cycle('1','0')}"}
        %td{:style=>"text-align:right;width:45%"}
          %strong
            #{prop[:label]}
            &nbsp;&nbsp;&nbsp;
        %td{:class=>"show_#{prop[:name]}"}
          $$$#{prop[:name]}$$$

  -#%br{:style=>'float:none; clear:both;'}
  -#%br

  %h4{:style=>"margin-top:0;"}
    Variable Data
    -if @auth
      %span{:style=>"font-size:11px;"}
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        = link_to('NEW VARIABLE', 'javascript:', :class=>'icon icon-add', :onclick=>"dojo.publish('voeis/project/variable', [0,'',$$$id$$$]);")
    
  %table{:id=>"site00-variable-table", :style=>"width:48%;foat:left;"}
    %tr{:class=>"row-gr"}
      %th{:width=>"30%"} Variable
      %th{:width=>"30%", :align=>"left"} Units / Type
      %th{:width=>"10%", :align=>"left"} Count
      %th{:width=>"14%"} Start
      %th{:width=>"14%"} Stop
    %tr
      %td
        $$$site-variable-data$$$

  %br{:style=>'float:none; clear:both;'}
  %div
    %h4{:style=>"margin-top:0;"}
      Existing Samples

  -##all_variables-site00{:style=>"$$$export-style$$$"}
  -#  = form_for("export", :url=> {:controller=>'/projects', :action=>'export'}) do 
  -#    = hidden_field_tag('column_array', @sample_labels.to_json)
  -#    = hidden_field_tag('row_array', "$$$site-samps$$$")
  -#    = hidden_field_tag('file_name', "project_samples")
  -#    = submit_tag("Export Samples")
  -#  %br
  -#  %br

  %table{:id=>"site00-sample-table", :style=>"width:45%;"} 
    %tr{:class=>"row-gr"}
      - @sample_properties.each do |prop|
        %th{:style=>"width:20%;align:center;"}
          %strong
            = prop[:label]
    %tr
      %td{:style=>"width:23%;align:center;"}
        $$$site-sample-data$$$
      
      
  -##testing-site00{:dojoType=>"dijit.form.Button"}
  -#  TESTING
  -#  %script{:type=>"dojo/method", :event=>"onClick", :args=>"evt"}
  -#    //var form = dijit.byId("site00_local_projection_form");
  -#    console.log('TEST BUTTON: CLICK!!');
  -#    alert('TEST BUTTON: CLICK!!');
    

#query-site00{:style=>"margin-top:0;padding-top:0;display:none;"}

  %strong QUERY SITE
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  - tabId = 'site00_data'
  -#= link_to('CANCEL EDIT', 'javascript:', :class=>'icon icon-cancel', :onclick=>"if($$$id$$$){$('#edit-site00').hide();$('#show-site00').show();}else{site0ref.close()};") 
  = link_to('CANCEL QUERY', 'javascript:', :class=>'icon icon-cancel', :onclick=>"$('#query-site00').hide();$('#show-site00').show();return false;") 
  %br
  %br
  %br
  
  -#= form_for(:query, @query, :url => {:controller=>'samples', :action=>'search'}, :remote=>true, :html=>{:id=>tabId+'_query'}) do |f|
  %form(accept-charset="UTF-8" class="new_voeis_site" data-remote="true" id="site00_query" dojoType="dijit.form.Form")
    -#%input{:type=>"hidden", :name=>"tab_id", :value=>"#{tabId}"}
    -#=hidden_field_tag('tab_id', tabId)
    =hidden_field_tag('site_select', "$$$id$$$")
    Variable
    ($$$site-variable-count$$$):
    
    :plain
      <select id="variable_select" name="variable_select" style="width:450px;">
        $$$site-variable-select$$$
      </select>
    %br{:style=>'float:none; clear:both;'}
    %br
    %br
    
    %p
      %strong
        Data available for:
      $$$site-data-start$$$
      &mdash;
      $$$site-data-end$$$
    
    Dates After: 
    -#= date_select('range', 'start_date', :start_year => @start_year, :end_year => @end_year, :order => [:month, :day, :year])
    -#%input(name="start_date" dojoType="dijit.form.DateTextBox" id="start_date00" value="#{@start_date}" constraints="{datePattern:'yyyy-MM-dd'}" style="width:200px!important;")
    %input(name="start_date" dojoType="dijit.form.DateTextBox" value="$$$site-date-start$$$" style="width:200px!important;")
    &nbsp;&nbsp;&nbsp;
    Dates Before: 
    -#= date_select('range', 'end_date', :start_year => @start_year, :end_year => @end_year, :order => [:month, :day, :year])
    -#%input(name="end_date" dojoType="dijit.form.DateTextBox" id="end_date00" value="#{@end_date}" constraints="{datePattern:'yyyy-MM-dd'}" style="width:200px!important;")
    %input(name="end_date" dojoType="dijit.form.DateTextBox" value="$$$site-date-end$$$" style="width:200px!important;")
    %br{:style=>'float:none; clear:both;'}
    %br
    You can Specify some value restrictions:
    %br
    Value:
    %select{:name =>"first_value_select"}
      %option{:value=>"blank"}
      %option{:value=>"eql"}
        Is equal to
      %option{:value=>"lte"}
        Is less than or equal to
      %option{:value=>"gte"}
        Is greater than or equal to
    %input{:type=>"text", :name =>"first_value_text"}
    %select{:name =>"and_or_select"}
      %option{:value=>"and"}
        And
      %option{:value=>"or"}
        Or
    %br
    Value:
    %select{:name =>"second_value_select"}
      %option{:value=>"blank"}
      %option{:value=>"eql"}
        Is equal to
      %option{:value=>"lte"}
        Is less than or equal to
      %option{:value=>"gte"}
        Is greater than or equal to
    %input{:type=>"text", :name =>"second_value_text"}
    
    %br
    %br
    -#  (<span id="vars_count">#{@variable_opts_array.count}</span>):
    -#= f.submit('Search', :onclick => "dijit.byId('loading_dialog').show();")
    -#= link_to('Cancel', project_path(@project), :class => 'icon icon-cancel') 
    %button(dojoType="dijit.form.Button" type="submit" name="submit_form" value="Search" onclick="site00ref.submitDataQuery();return false;")
      Search

    &nbsp;&nbsp;
    %button(dojoType="dijit.form.Button" name="cancel" value="Cancel" onclick="window.location=#{project_path(@project)}") 
      Cancel
      %script{:type=>"dojo/method", :event=>"onClick"}
        :plain
          $('#query-site00').hide();
          $('#show-site00').show();

  %br{:style=>'float:none; clear:both;'}
  %br
  

-if @auth
  -##edit-site00{:dojoType=>"dijit.layout.ContentPane", :title=>'EDIT', :style=>"margin-top:0;padding-top:0;display:none;"}
  #edit-site00{:style=>"margin-top:0;padding-top:0;display:none;"}

    #site00_lat_long_picker{:dojoType=>"dijit.Dialog", :jsId=>"site00_lat_long_picker", :title=>"Select location for Latitude/Longitude v0 (click/shift-click to zoom in/out)", 
      :style=>"padding:0;"}
      %script{:type=>"dojo/method", :event=>"onShow"}
        :plain
          //var form = dijit.byId("site00_vertical_datum_form");
          var form = site00_edit_form;
          site00_lat_long = {};
          //var mapdiv = dojo.byId("site00_loat_long_mapdiv");
          var mapdiv = document.getElementById('site00_lat_long_mapdiv');
          var innerdiv = document.getElementById('site00_lat_long_innerdiv');
          var button = document.getElementById('site00_lat_long_map_control')
          var mapclick = false;
          var crosshairShape = {coords:[0,0,0,0],type:'rect'};
          var crosshairImg = '/images/cross-hairs.gif';
          var map_center = new google.maps.LatLng(39.707187,-96.152344);
          var map_zoom = 3;
          if(!site00ref.newSite) {
            map_center = new google.maps.LatLng(parseFloat(site00ref.site.latitude),parseFloat(site00ref.site.longitude));
            map_zoom = 15;
            console.log('EDIT SITE MAP:',map_center);
          };
          site00_lat_long.map_opts = {
            //center: new google.maps.LatLng(46.739861,-110.786133), 
            center: map_center,
            zoom: map_zoom,
            mapTypeId: google.maps.MapTypeId.HYBRID,
            //mapTypeId: google.maps.MapTypeId.SATELLITE,
            //mapTypeId: google.maps.MapTypeId.TERRAIN,
            draggableCursor: 'crosshair',
            scaleControl: true, 
            zoomControl: true, 
            mapTypeControl: true,
            scrollwheel: true
          };
          var myOptions = {
            zoom:12,
            center:new google.maps.LatLng(39.707187,-96.152344),
            mapTypeId:google.maps.MapTypeId.SATELLITE,
            draggableCursor:'crosshair',
            mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.DROPDOWN_MENU}
          };
        
          site00_lat_long.map = new google.maps.Map(mapdiv, site00_lat_long.map_opts);
          site00_lat_long.crosshair = new google.maps.Marker({
            map: site00_lat_long.map,
            icon: crosshairImg,
            shape: crosshairShape
          });
          site00_lat_long.crosshair.bindTo('position',site00_lat_long.map,'center');
          site00_lat_long.map.controls[google.maps.ControlPosition.RIGHT_TOP].push(button);
          //###CLICK-MAP
          $('body').click( function(e){
            console.log('DOMCLICK:',e);
            if(!mapclick) return;
            var clickat = mapclick.latLng;
            var mapzoom = site00_lat_long.map.getZoom();
            if(e.shiftKey) mapzoom -= 1;
            else mapzoom += 1;
            site00_lat_long.map.setCenter(clickat);
            site00_lat_long.map.setZoom(mapzoom);
            mapclick = false;
          });
          //google.maps.event.addDomListener(mapdiv, 'click', function(ev){ domclick = ev; });
          google.maps.event.addListener(site00_lat_long.map, 'click', function(mapev){ 
            mapclick = mapev;
            //mapclick['mapCenter'] = site00_lat_long.map.getCenter();
            var clickat = mapev.latLng;
            console.log('CLICKAT:',clickat.toString());
          });
          //###SELECT FUNCTION
          site00_lat_long.map_select = function(){
            var form = site00_edit_form.domNode;
            var formlat = dijit.byId('site00_latitude');
            var formlong = dijit.byId('site00_longitude');
            var mapCenter = site00_lat_long.map.getCenter();
            formlat.set('value',mapCenter.lat());
            formlong.set('value',mapCenter.lng());
            site00_lat_long_picker.hide();
          };
          //###ON-HIDE
          this.connect(this, "onHide", function(){
            //var form = site00_edit_form.domNode;
            //form.elements['site_lat_long_datum'].focus();
            var formlat = dijit.byId('site00_latitude');
            formlat.focus();
          });
      #site00_lat_long_mapdiv{:style=>"margin:0!important;"}
        #site00_lat_long_map_control{:onclick=>"site00_lat_long.map_select();"}
          %a{:href=>"javascript:", :onclick=>"alert('TESTING!!!');this.hide();return false;"}
    
    -#site00_xnew_local_projection{:dojoType=>"dijit.Dialog", :title=>"NEW Local Projection"}
    -##site00_new_local_projection{:dojoType=>"dijit.Dialog", :jsId=>"site00_new_local_projection", :title=>"NEW Local Projection"}
    -#  TESTING Local Projection
    -##site00_new_vertical_datum{:dojoType=>"dijit.Dialog", :jsId=>"site00_new_local_projection", :title=>"NEW Local Projection"}
    -#  TESTING Vertical Datum

    #site00_new_vertical_datum{:dojoType=>"dijit.Dialog", :jsId=>"site00_new_vertical_datum", :title=>"NEW Vertical Datum", :style=>"width:400px;"}
      %form(id="site00_vertical_datum_form" jsId="site00_vertical_datum_form" dojoType="dijit.form.Form" method="post")
        %label Term
        %br
        %input(name="vertical_datum_term" dojoType="dijit.form.ValidationTextBox" id="site00_vertical_datum_term" size="30" required="true")
        %br{:style=>'float:none; clear:both;'}
        %br
        %label Definition
        %br
        %textarea{:type=>"text", :name=>"vertical_datum_definition", :id=>"site00_vertical_datum_definition", :style=>"width:95%;", :rows=>"4"}
        %br{:style=>'float:none; clear:both;'}
        %br
        %button{:id=>"site00_vertical_datum_submit_button",:dojoType=>"dijit.form.Button", :title=>'Create'}
          Create Vertical Datum
          %script{:type=>"dojo/method", :event=>"startup"}
            :plain
              var form = dijit.byId("site00_vertical_datum_form");
              //var form = dijit.byId("site00_vertical_datum_form");
              // set initial state
              this.attr("disabled", !form.isValid());
              this.connect(form, "onValidStateChange", function(state){
                this.attr("disabled", !state);
              });
              this.connect(this, "onClick", function(){
                var data = {vertical_datum_c_v: {
                  term: $("#site00_vertical_datum_term").val(),
                  definition: $("#site00_vertical_datum_definition").val()}};
                console.log('POST:',data);
                $.post("/vertical_datum_c_vs.json", data, function(dat) {
                  $('#site00_vertical_datum').append($("<option></option>").attr("value",dat['id']).text($('#site00_vertical_datum_term').val()));
                  $('#site00_vertical_datum').val(dat['id']);
                  site00_new_vertical_datum.hide();
                });
              });
        &nbsp;&nbsp;
        %button{:dojoType=>"dijit.form.Button", :title=>'Cancel', :onClick=>"site00_new_vertical_datum.hide();return false;"} Cancel
    
    -#site00_xnew_local_projection{:title=>"NEW Local Projection", :style=>"display:none;"}
    #site00_new_spatial_reference{:dojoType=>"dijit.Dialog", :jsId=>"site00_new_spatial_reference", :title=>"NEW Spatial Reference", :style=>"width:400px;"}
      %form(id="site00_spatial_reference_form" jsId="site00_spatial_reference_form" dojoType="dijit.form.Form" method="post")
        %label Source ID
        %br
        -#=f.text_field :quality_control_level_code, :size => 30
        -#%input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :dojoType=>"dijit.form.ValidationTextBox", :size=>40,  :style=>"width:30em", :required=>"true"}
        -#%input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :style=>"width:95%;"}
        %input(name="source_id" dojoType="dijit.form.NumberTextBox" id="site00_source_id" size="30" required="true")
        %br{:style=>'float:none; clear:both;'}
        %br
        %label Source Name
        %br
        -#=f.text_field :quality_control_level_code, :size => 30
        -#%input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :dojoType=>"dijit.form.ValidationTextBox", :size=>40,  :style=>"width:30em", :required=>"true"}
        -#%input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :style=>"width:95%;"}
        %input(name="source_name" dojoType="dijit.form.ValidationTextBox" id="site00_source_name" size="50" required="true")
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        %input(name="source_geographic" dojoType="dijit.form.CheckBox" id="site00_source_geographic")
        Geographic
        
        %br{:style=>'float:none; clear:both;'}
        %br
        %label Notes
        %br
        -#=f.text_area :definition, :cols=>50, :rows=>3
        -#%input{:type=>"text", :name=>"local_projection_definition", :id=>"site00_local_projection_definition", :dojoType=>"dijit.form.ValidationTextBox", :style=>"width:50em", :size=>50, :rows=>"3"}
        %textarea{:type=>"text", :name=>"source_notes", :id=>"site00_source_notes", :style=>"width:95%;", :rows=>"4"}
        %br{:style=>'float:none; clear:both;'}
        %br
        -#%button{:id=> 'site00_new_local_projection_buttonx',:dojoType=>"dijit.form.Button", :title=>'Create', :onClick=>"site00_createLocalProjection();"}
        -#%button{:id=>'site00_new_local_projection_buttonx',:dojoType=>"dijit.form.Button", :title=>'Create'}
        -#%button{:id=>'site00_new_local_projection_button', :value=>"Create Local Projection", :onclick=>"submit_site_dialog($$$id$$$,'local_projection');site00ref.dialog.hide();return false;"}
        %button{:id=>"site00_source_submit_button",:dojoType=>"dijit.form.Button", :title=>'Create'}
          Create Spatial Reference
          %script{:type=>"dojo/method", :event=>"startup"}
            :plain
              var form = dijit.byId("site00_spatial_reference_form");
              // set initial state
              this.attr("disabled", !form.isValid());
              this.connect(form, "onValidStateChange", function(state){
                this.attr("disabled", !state);
              });
              this.connect(this, "onClick", function(){
                var is_geo = (dojo.byId("site00_source_geographic").checked) ? true : false;
                var data = {spatial_reference: {
                  srs_id: parseInt($("#site00_source_id").val()),
                  srs_name: $("#site00_source_name").val(),
                  is_geographic: is_geo,
                  notes: $("#site00_source_notes").val()}};
                console.log('POST:',data);
                $.post("/spatial_references.json", data, function(dat) {
                  $('#site00_lat_long_datum').append($("<option></option>").attr("value",dat['id']).text($('#site00_source_name').val()));
                  if(SRfrom=='LLD') $('#site00_lat_long_datum').val(dat['id']);
                  $('#site00_local_projection').append($("<option></option>").attr("value",dat['id']).text($('#site00_source_name').val()));
                  if(SRfrom='LP') $('#site00_local_projection').val(dat['id']);
                  site00_new_spatial_reference.hide();
                });
              });
        &nbsp;&nbsp;
        -#%button{:onclick=>"site00ref.dialog.hide();return false;", :value=>"Cancel"} Cancel
        %button{:dojoType=>"dijit.form.Button", :title=>'Cancel', :onClick=>"site00_new_spatial_reference.hide();return false;"} Cancel
    
    
    -##site00_xnew_local_projection{:title=>"NEW Local Projection", :style=>"display:none;"}
    -#  -#= form_for :local_projection, :url=>"", :html=>{:dojoType=>"dijit.form.Form", :id=>"site00_local_projection_form"} do |f|
    -#  -#%form(id="site00_local_projection_form" jsId="site00_local_projection_form" dojoType="dijit.form.Form" method="post")
    -#  %form(id="site00_local_projection_form" method="post")
    -#    %label Term
    -#    %br
    -#    -#=f.text_field :quality_control_level_code, :size => 30
    -#    -#%input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :dojoType=>"dijit.form.ValidationTextBox", :size=>40,  :style=>"width:30em", :required=>"true"}
    -#    %input{:type=>"text", :name=>"local_projection_term", :id=>"site00_local_projection_term", :style=>"width:95%;"}
    -#    %br{:style=>'float:none; clear:both;'}
    -#    %br
    -#    %label Definition
    -#    %br
    -#    -#=f.text_area :definition, :cols=>50, :rows=>3
    -#    -#%input{:type=>"text", :name=>"local_projection_definition", :id=>"site00_local_projection_definition", :dojoType=>"dijit.form.ValidationTextBox", :style=>"width:50em", :size=>50, :rows=>"3"}
    -#    %textarea{:type=>"text", :name=>"local_projection_definition", :id=>"site00_local_projection_definition", :style=>"width:95%;", :rows=>"4"}
    -#    %br{:style=>'float:none; clear:both;'}
    -#    %br
    -#    -#%button{:id=> 'site00_new_local_projection_buttonx',:dojoType=>"dijit.form.Button", :title=>'Create', :onClick=>"site00_createLocalProjection();"}
    -#    -#%button{:id=>'site00_new_local_projection_buttonx',:dojoType=>"dijit.form.Button", :title=>'Create'}
    -#    %button{:id=>'site00_new_local_projection_button', :value=>"Create Local Projection", :onclick=>"submit_site_dialog($$$id$$$,'local_projection');site00ref.dialog.hide();return false;"}
    -#      Create Local Projection
    -#      -#%script{:type=>"dojo/method", :event=>"startup"}
    -#      -#  var form = dijit.byId("site00_local_projection_form");
    -#      -#  // set initial state
    -#      -#  //this.attr("disabled", !form.isValid());
    -#      -#  //this.connect(form, "onValidStateChange", function(state){
    -#      -#  //this.attr("disabled", !state);
    -#      -#  //});
    -#      -#  this.connect(form, "onClick", function(){
    -#      -#  //$.post("#{root_url}/local_projection_cvs.json?local_projection_c_vs[term]="+$("#site00_local_projection_term").val()+"&local_projection_c_vs[definition]="+$("#site00_local_projection_definition").val(),
    -#      -#  $.post("#{@root_url}/local_projection_c_vs.json", {local_projection_c_v: {term: $("#site00_local_projection_term").val(), definition: $("#site00_local_projection_definition").val()}},
    -#      -#  function(data) {
    -#      -#  //$('#site00_local_projection').append($("<option></option>").attr("value",data['id']).text($("#site00_vertical_datum_term").val() + ':' + $("#site00_vertical_datum_definition").val())); 
    -#      -#  $('#site00_local_projection').append($("<option></option>").attr("value",data['id']).text($("#site00_vertical_datum_term").val()));
    -#      -#  $('#site00_local_projection').val(data['id']);
    -#      -#  dijit.byId("site00_xnew_local_projection").hide();
    -#      -#  });
    -#      -#  };
    -#    &nbsp;&nbsp;
    -#    -#%button{:dojoType=>"dijit.form.Button", :title=>'Cancel', :onClick=>"dijit.byNode(dojo.byId('site00')).dialog.hide();"} Cancel
    -#    %button{:onclick=>"site00ref.dialog.hide();return false;", :value=>"Cancel"} Cancel
    -#
    -##site00_xnew_vertical_datum{:title=>"NEW Vertical Datum", :style=>"display:none;"}
    -#  -#= form_for :vertical_datum_c_vs, :url=>"", :html=>{:dojoType=>"dijit.form.Form", :id=>"site00_vertical_datum_form"} do |f|
    -#  -#%form(id="site00_vertical_datum_form" jsId="site00_vertical_datum_form" dojoType="dijit.form.Form" method="post")
    -#  %form(id="site00_vertical_datum_formXX" method="post")
    -#    %label Term
    -#    %br
    -#    -#=f.text_field :quality_control_level_code, :size => 30
    -#    -#%input{:type=>"text", :name=>"vertical_datum_term", :id=>"site00_vertical_datum_term", :dojoType=>"dijit.form.ValidationTextBox", :size=>40,  :style=>"width:30em", :required=>"true"}
    -#    %input{:type=>"text", :name=>"vertical_datum_term", :id=>"site00_vertical_datum_termXX", :style=>"width:95%;"}
    -#    %br{:style=>'float:none; clear:both;'}
    -#    %br
    -#    %label Definition
    -#    %br
    -#    -#=f.text_area :definition, :cols=>50, :rows=>3
    -#    -#%input{:type=>"text", :name=>"vertical_datum_definition", :id=>"site00_vertical_datum_definition", :dojoType=>"dijit.form.ValidationTextBox", :style=>"width:50em", :size=>50, :rows=>"3", :required=>"true"}
    -#    %textarea{:type=>"text", :name=>"vertical_datum_definition", :id=>"site00_vertical_datum_definitionXX", :style=>"width:95%;", :rows=>"4"}
    -#    %br{:style=>'float:none; clear:both;'}
    -#    %br
    -#    -#%button{:id=> 'site00_new_vertical_datum_button',:dojoType=>"dijit.form.Button", :title=>'Create', :onClick=>"site00_createVerticalDatum();return false;"}
    -#    -#%button{:id=> 'site00_new_vertical_datum_button',:dojoType=>"dijit.form.Button", :title=>'Create'}
    -#    %button{:id=> 'site00_new_vertical_datum_buttonXX', :value=>"Create Vertical Datum", :onClick=>"submit_site_dialog($$$id$$$,'vertical_datum');site00ref.dialog.hide();return false;"}
    -#      Create Vertical Datum
    -#      -#%script{:type=>"dojo/method", :event=>"startup"}
    -#      -#  var form = dijit.byNode(dojo.byId("site00_vertical_datum_form"));
    -#      -#  // set initial state
    -#      -#  this.attr("disabled", !form.isValid());
    -#      -#  this.connect(form, "onValidStateChange", function(state){
    -#      -#  this.attr("disabled", !state);
    -#      -#  });
    -#      -#  this.connect(form, "onClick", function(){
    -#      -#  console.log('create Vert Datum CV');
    -#      -#  $.post("#{@root_url}/vertical_datum_c_vs.json", {vertical_datum_c_v: {term: $("#site00_vertical_datum_term").val(), definition: $("#site00_vertical_datum_definition").val()}},
    -#      -#  function(data) {
    -#      -#  //$('#site00_vertical_datum').append($("<option></option>").attr("value",data['id']).text($("#site00_vertical_datum_term").val() + ':' + $("#site00_vertical_datum_definition").val()));
    -#      -#  $('#site00_vertical_datum').append($("<option></option>").attr("value",data['id']).text($("#vertical_datum_term").val()));
    -#      -#  $('#site00_vertical_datum').val(data['id']);
    -#      -#  dijit.byId("site00_xnew_vertical_datum").hide();
    -#      -#  });
    -#      -#  };
    -#    &nbsp;&nbsp;
    -#    -#%button{:dojoType=>"dijit.form.Button", :title=>'Cancel', :onClick=>"dijit.byNode(dojo.byId('site00')).dialog.hide();"} Cancel
    -#    %button{:onClick=>"site00ref.dialog.hide();return false;", :value=>"Cancel"} Cancel

    -#%table{:id=>"site00-edit-control"}
    -#  %tr
    -#    %td{:style=>"width:200px;"}
    -#      %strong EDIT SITE
    -#    %td
    -#      = link_to('CANCEL EDIT', 'javascript:', :class=>'icon icon-cancel', :onclick=>"$('#edit-site00').hide();$('#show-site00').show();") 
    -#%br

    %strong EDIT SITE
    &nbsp;&nbsp;&nbsp; (* Required)
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    -#= link_to('CANCEL EDIT', 'javascript:', :class=>'icon icon-cancel', :onclick=>"if($$$id$$$){$('#edit-site00').hide();$('#show-site00').show();}else{site0ref.close()};") 
    = link_to('CANCEL EDIT', 'javascript:', :class=>'icon icon-cancel', :onclick=>"cancel_site_form($$$id$$$);") 
    %br


    -#%script{:type=>"dojo/method"}
    %script{:type=>"text/javascript"}
      :plain
        console.log('DOJO/METHOD');

        function drop_down(form,fn,value) {
          var fld = form.elements[fn];
          if(!fld) return null;
          if(value)
            for(var i=0;i<fld.options.length;i++) 
              if(fld.options[i].value==value)
          fld.options[i].selected=true;
          if(fld.selectedIndex==-1 || fld.options.length==0) 
            return {value:null, text:'-none-', element:fld};
          var opt = fld.options[fld.selectedIndex];
          var ddez = {
            element:fld,
            value:function(){ return fld.value },
            ivalue:function(){ return parseInt(fld.value) },
            xvalue:function(){return parseInt(fld.options[fld.selectedIndex].value)},
            text:function(){return fld.options[fld.selectedIndex].text}
          };
          return {value:parseInt(opt.value), text:opt.text, element:fld, dd:ddez};
        }

        function pane_update(pane) {
          var site = pane.site;
          var form0 = pane.id+'-edit-form';
          var form = dijit.byId(form0);
          form0 = form.domNode;
          console.log('UPDATE PANE:',form0);
          //INITIALIZE: drop-downs
          pane.local.lat_long_datum_dd = drop_down(form0,'site_lat_long_datum',site.lat_long_datum_id).dd;
          pane.local.local_projection_dd = drop_down(form0,'site_local_projection',site.local_projection_id).dd;
          pane.local.vertical_datum_dd = drop_down(form0,'site_vertical_datum',site.vertical_datum_id).dd;
          console.log('>>>PANE_UPDATE: SITE:',site);
          console.log('LatLongDatum ID:',pane.local.lat_long_datum_dd.value,pane.local.lat_long_datum_dd.text());
          console.log('VerticalDatum ID:',pane.local.vertical_datum_dd.value,pane.local.vertical_datum_dd.text());
          console.log('LocalProjection ID:',pane.local.local_projection_dd.value,pane.local.local_projection_dd.text());
        }

        function cancel_site_form(siteId) {
          //###SCROLL TO TOP
          //window.scrollTo(0,0);
          $('html #main_container').animate({scrollTop:0}, 'slow');//IE, FF
          $('body #main_container').animate({scrollTop:0}, 'slow');//chrome, don't know if safary works
          $('html #edit-site'+siteId).animate({scrollTop:0}, 'slow');//IE, FF
          $('body #edit-site'+siteId).animate({scrollTop:0}, 'slow');//chrome, don't know if safary works
          if(parseInt(siteId)) {
            //EXISTING SITE
            var sitePane = window['site'+siteId+'ref'];
            sitePane.siteUpdate(sitePane.getSite());
            $('#edit-site'+siteId).hide();
            $('#show-site'+siteId).show();
            return
          };
          //NEW SITE
          dojo.publish('voeis/project/site/close',[0]);
        };
        function delete_site(site_id){
          confirmDialog(
            'DELETE SITE?',
            'Are you sure you want to <br/>DELETE this site (ID: '+site_id+')?',
            function(yes) {
              if(yes) {
                $.ajax({
                  url: '#{project_path(@project)}/sites/'+site_id.toString(),
                  type: "DELETE",
                  dataType: "json"}).done(
                  function (data){
                    alert(data["msg"]);    
                  })}},
            {buttonOk:'YES!'});
        }
      

    -#= form_for(:site, @site, :remote=>true, :url=>project_site_path(@project, @site), :builder=>YogoFormBuilder, :html=>{:method=>"put", :onsubmit=>"return checkform();"} )do |f|
    -#= form_for(:site, @site, :remote=>true, :url=>"/projects/#{@project.id}/sites/$$$id$$$/", :html=>{:method=>:put, :id=>"site00-edit-form", :onsubmit=>"dijit.byNode(dojo.byId('site00')).siteFormSave(this);return true;"} )do |f|
    -#= form_for(@site0, :remote=>true, :url=>"/projects/#{@project.id}/sites/$$$id$$$/", :html=>{:method=>:put, :id=>"site00-edit-form"} )do |f|
    -# = form_for(@site, :as=>:site, :remote=>true, :url=>"/projects/#{@project.id}/sites/$$$id$$$/", :html=>{:method=>:put, :id=>"site00-edit-form"} )do |f|
    -#%form(accept-charset="UTF-8" action="/projects/b6db01d0-e606-11df-863f-6e9ffb75bc80/sites/$$$id$$$" class="new_voeis_site" data-remote="true" id="site00-edit-form" dojoType="dijit.form.Form" method="put")
    -#%form(accept-charset="UTF-8" action="/projects/b6db01d0-e606-11df-863f-6e9ffb75bc80/sites/$$$id$$$" class="new_voeis_site" data-remote="true" id="site00-edit-form" jsId="site00_edit_form" dojoType="dijit.form.Form" method="put")
    -#%form(accept-charset="UTF-8" action="/projects/b6db01d0-e606-11df-863f-6e9ffb75bc80/sites/$$$id$$$" class="new_voeis_site" data-remote="true" id="site00-edit-form" method="put")
    
    -#%form(accept-charset="UTF-8" action="/projects/b6db01d0-e606-11df-863f-6e9ffb75bc80/sites/$$$id$$$" class="new_voeis_site" data-remote="true" id="site00-edit-form" method="put")
    %form(accept-charset="UTF-8" class="new_voeis_site" data-remote="true" id="site00-edit-form" jsId="site00_edit_form" dojoType="dijit.form.Form")
      -#--%script{:type=>"dojo/method", :event=>"onValidStateChange", :args=>"state"}
      -#--var submit_button = dijit.byId('site00_voeis_site_submit');
      -#--// set changed state
      -#--console.log('formStateChange:',state);
      -#--submit_button.attr("disabled", !state);
      -#--%script{:type=>"dojo/method", :event=>"startup"}
      -#--var submit_button = dijit.byId('site00_voeis_site_submit');
      -#--// set initial state
      -#--//submit_button.attr("disabled", !this.validate());
      -#--//submit_button.attr("disabled", !this.isValid());
      -#--//this.connect(this, "onValidStateChange", function(state){
      -#--//submit_button.attr("disabled", !this.validate());
      -#--//this.domNode.elements['site_name'].focus()
      -#--//});
      -#%script{:type=>"dojo/method", :event=>"onValidStateChange", :args=>"state"}
      -#  var submit_button = dijit.byId('site00_voeis_site_submit');
      -#  // set changed state
      -#  submit_button.attr("disabled", !state);

      %table{:id=>"form-table"}
        %tr
          %td
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_name"} Name *
              -#= f.text_field("name", :value=>"$$$name$$$")
              -#%input(name="site_name" dojoType="dijit.form.ValidationTextBox" size="50" type="text" value="$$$name$$$" required="true")
              -#%input(name="site_name" id="site00_name" type="text" value="$$$name$$$")
              %input(name="site_name" class="TextBox_name" dojoType="dijit.form.ValidationTextBox" id="site00_name" type="text" value="$$$name$$$" required="true")
          %td
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_code"} Code *
              -#= f.text_field("code", :value=>"$$$code$$$")
              -#%input(name="site_code"  dojoType="dijit.form.ValidationTextBox"  size="30" type="text" value="$$$code$$$" required="true")
              -#%input(name="site_code"  type="text" value="$$$code$$$")
              %input(name="site_code" dojoType="dijit.form.ValidationTextBox" type="text" value="$$$code$$$" required="true")
        %tr
          %td{:colspan=>"2"}
            .from-element{:style=>"cursor:pointer;margin-top:10px;"}
            -#%a{:style=>"cursor:pointer;", :class=>"icon icon-notice", :href=>"javascript:", :onclick=>"site_lat_long_picker.open($$$id$$$);return false;"}
            %a{:style=>"cursor:pointer;", :class=>"icon icon-notice", :href=>"javascript:", :onclick=>"thisSite='site00';site_lat_long_picker.show();return false;"}
              Select MAP location to populate Latitude & Longitude
            &nbsp;&nbsp;&nbsp;&nbsp;
            -#%br
            -#%a{:style=>"cursor:pointer;", :class=>"icon icon-notice", :href=>"javascript:", :onclick=>"site00_lat_long_picker.show();return false;"}
            -#  Select MAP location to populate Latitude & Longitude v0
            
        %tr
          %td
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_latitude"} Latitude *
              -#= f.text_field("latitude", :value=>"$$$latitude$$$")
              -#%input(name="site_latitude"  dojoType="dijit.form.ValidationTextBox"  size="30" type="text" value="$$$latitude$$$" required="true")
              -#%input(name="site_latitude" id="site00_latitude" type="text" value="$$$latitude$$$")
              %input(name="site_latitude" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" id="site00_latitude" type="text" value="$$$latitude$$$" required="true")
          %td
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_longitude"} Longitude *
              -#= f.text_field("longitude", :value=>"$$$longitude$$$")
              -#%input(name="site_longitude"  dojoType="dijit.form.ValidationTextBox"  size="30" type="text" value="$$$longitude$$$" required="true")
              -#%input(name="site_longitude" id="site00_longitude" type="text" value="$$$longitude$$$")
              %input(name="site_longitude" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" id="site00_longitude" type="text" value="$$$longitude$$$" required="true")

        %tr
          %td{:colspan=>"2"}
            .from-element{:style=>"cursor:pointer;"}
              -#%span{:class=>'label', :style=>"cursor:pointer;"}
              -#%label{:for=>"site_lat_long_datum", :style=>"cursor:pointer;", :class=>"icon icon-add", :onclick=>"site_new_spatial_reference.open($('.site00_spatial_ref'),$('#site00_lat_long_datum'));"}
              -#%a{:href=>"javascript:", :onclick=>"thisSite='site00';site_new_spatial_reference.show();return false;"}
              %a{:href=>"#{project_path(@project)}/spatial_references", :onclick=>"cv_pop_new('Spatial Reference','spatial_reference',this.href,'site00_lat_long_datum');return false;"}
                %label{:for=>"site_lat_long_datum", :style=>"cursor:pointer;", :class=>"label icon icon-add"}
                  Latitude Longitude Datum
            -#= f.text_field("local_projection", :value=>"$$$local_projection$$$") 
            -#= f.select('local_projection',  options_for_select(@local_projection_items, '$$$local_projection$$$'), :class=>"form-dropdown")
            %select(id="site00_lat_long_datum" class="site00_spatial_ref spatial_reference_select" name="site_lat_long_datum")
              - @local_projection_items.each do |item|
                %option(value="#{item[1]}") #{item[0]}

        %tr
          %td{:colspan=>"2"}
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_elevation_m"} Elevation
              -#= f.text_field("elevation_m", :value=>"$$$elevation_m$$$")
              -#%input(name="site_elevation_m" type="text" value="$$$elevation_m$$$")
              %input(name="site_elevation_m" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" type="text" value="$$$elevation_m$$$")
        %tr
          %td 
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_local_x"} Local X
              -#= f.text_field("local_x", :value=>"$$$local_x$$$")
              -#%input(name="site_local_x"  type="text" value="$$$local_x$$$")
              %input(name="site_local_x" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" type="text" value="$$$local_x$$$")
          %td 
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_local_y"} Local Y
              -#= f.text_field("local_y", :value=>"$$$local_y$$$")
              -#%input(name="site_local_y"  type="text" value="$$$local_y$$$")
              %input(name="site_local_y" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" type="text" value="$$$local_y$$$")

        %tr
          %td{:colspan=>"2"}
            .from-element{:style=>"cursor:pointer;"}
              -#%span{:class=>'label', :style=>"cursor:pointer;"}
              -#%a{:href=>"javascript:", :onclick=>"thisSite='site00';site_new_spatial_reference.show();return false;"}
              -#%a{:href=>"#{project_path(@project)}/spatial_references", :onclick=>"cv_pop_new('Spatial Reference','spatial_reference',this.href,'site00_lat_long_datum');return false;"}
              %a{:href=>"javascript:", :onclick=>"cv_pop_new('Spatial Reference','spatial_reference','#{project_path(@project)}/spatial_references','site00_local_projection');return false;"}
                %label{:for=>"site_local_projection", :style=>"cursor:pointer;", :class=>"label icon icon-add"}
                  Local Projection
            -#= f.text_field("local_projection", :value=>"$$$local_projection$$$") 
            -#= f.select('local_projection',  options_for_select(@local_projection_items, '$$$local_projection$$$'), :class=>"form-dropdown")
            %select(id="site00_local_projection" class="site00_spatial_ref spatial_reference_select" name="site_local_projection")
              - @local_projection_items.each do |item|
                %option(value="#{item[1]}") #{item[0]}
            -#%td{:style=>"padding-top:20px;"}
            -#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            -#= link_to('NEW', 'javascript:', :onclick=>"dijit.byId('site00_new_local_projection').show();")
            -#= link_to('NEW', 'javascript:', :onclick=>"$('#edit-site00 .hide-row').hide();$('#site00_new_local_projection_row').show();")
            -#= link_to('NEW', 'javascript:', :onclick=>"dijit.byNode(dojo.byId('site00')).showDialog('site00_xnew_local_projection');")

        %tr
          %td{:colspan=>"2"}
            .from-element{:style=>"cursor:pointer;"}
              -#%span{:class=>'label', :style=>"cursor:pointer;"}
              -#%label{:for=>"site_vertical_datum", :style=>"cursor:pointer;", :class=>"icon icon-add", :onclick=>"dijit.byNode(dojo.byId('site00')).showDialog('site00_xnew_vertical_datum');"}
              -#%label{:for=>"site_vertical_datum", :style=>"cursor:pointer;", :class=>"icon icon-add", :onclick=>"site_new_vertical_datum.open($('#site00_vertical_datum'),$('#site00_vertical_datum'));"}
              -#%a{:href=>"javascript:", :onclick=>"thisSite='site00';site_new_vertical_datum.show();return false;"}
              %a{:href=>"#{project_path(@project)}/vertical_datum_c_vs", :onclick=>"cv_pop_new('Vertical Datum','vertical_datum',this.href,'site00_vertical_datum');return false;"}
                %label{:for=>"site_vertical_datum", :style=>"cursor:pointer;", :class=>"label icon icon-add"}
                  Vertical Datum
            -#= f.text_field("vertical_datum", :value=>"$$$vertical_datum_id$$$") 
            -#= f.select("site00_vertical_datum", options_for_select([]), :class=>"form-dropdown")
            -#= f.select('vertical_datum', options_for_select(@vertical_datum_items), :class=>"form-dropdown")
            %select(id="site00_vertical_datum" name="site_vertical_datum" class="vertical_datum_select")
              - @vertical_datum_items.each do |item|
                %option(value="#{item[1]}") #{item[0]}
            -#%td{:style=>"padding-top:20px;"}
            -#&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            -#= link_to('NEW', 'javascript:', :onclick=>"$('#edit-site00 .hide-row').hide();$('#site00_new_vertical_datum_row').show();")
            -#= link_to('NEW', 'javascript:', :onclick=>"dijit.byNode(dojo.byId('site00')).showDialog('site00_xnew_vertical_datum');")

        %tr
          %td{:colspan=>"2"}
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_pos_accuracy_m"} Position Accuracy
            -#= f.text_field("pos_accuracy_m", :value=>"$$$pos_accuracy_m$$$")
            -#%input(name="site_pos_accuracy_m" type="text" value="$$$pos_accuracy_m$$$")
            %input(name="site_pos_accuracy_m" dojoType="dijit.form.NumberTextBox" constraints="{pattern:'######.######'}" type="text" value="$$$pos_accuracy_m$$$")
        %tr
          %td 
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_state"} State *
            -#= f.text_field("state", :value=>"$$$state$$$")
            -#%input(name="site_state" type="text" value="$$$state$$$")
            %input(name="site_state" dojoType="dijit.form.ValidationTextBox" type="text" value="$$$state$$$" required="true")
          %td 
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_county"} County
            -#= f.text_field("county", :value=>"$$$county$$$")
            -#%input(name="site_county" type="text" value="$$$county$$$")
            %input(name="site_county" dojoType="dijit.form.ValidationTextBox" type="text" value="$$$county$$$")
        %tr
          %td{:colspan=>"2"}
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_description"} Description
            -#= f.text_area("description", :value=>"$$$description$$$")
            -#%textarea( name="site_description" id="site00_description" rows="5")
            -#site00-description(name="site_description" dojoType="dijit.form.Textarea")
            -#%textarea( name="site_description" id="site00_description" rows="5")
            %input(name="site_description" dojoType="dijit.form.Textarea" id="site00_description" 
                  style="width:490px!important;line-height:16px!important;" value="$$$description$$$")
        %tr
          %td{:colspan=>"2"}
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_comments"} Comments
            -#= f.text_area("comments", :value=>"$$$comments$$$")
            -#%textarea( name="site_comments" id="site00_comments" rows="5")
            -#site00-comments(name="site_comments" dojoType="dijit.form.Textarea")
            -#%textarea( name="site_comments" id="site00_comments" rows="5")
            %input(name="site_comments" dojoType="dijit.form.Textarea" id="site00_comments" 
                  style="width:490px!important;line-height:16px!important;" value="$$$comments$$$")
        %tr{:id=>"site00-provenance-row"}
          %td{:colspan=>"2"}
            .from-element
              %span{:class=>'label'}
                %label{:for=>"site_provenance_comment"} Provenance Comment
            -#%textarea( name="site_provenance_comment" id="site00_provenance_comment" rows="2")
            -#$$$provenance_comment$$$
            %input(name="site_provenance_comment" dojoType="dijit.form.SimpleTextarea" id="site00_provenance_comment" 
                  style="width:485px!important;line-height:16px!important;" rows="3")
        
        %tr
          %td{:colspan=>"2"}
            %br
            -#= f.submit("Save Site", :onclick => "$('#loader').toggle();")
            -#%button(id="site00_voeis_site_submit" name="commit" dojoType="dijit.form.Button" onclick="if(formValid()){$('#loader').toggle();formSend();};")
            -#%button(id="site00_voeis_site_submit" name="commit" dojoType="dijit.form.Button" onclick="console.log('CLICK!');")
            -#%button(id="site00_voeis_site_submit" jsId="site00_voeis_site_submit" name="commit" dojoType="dijit.form.Button") Save Site
            -#%button(dojoType="dijit.form.Button" id="site00_voeis_site_submit" name="commit" value="Save Site" onClick="submit_site_form($$$id$$$);return false;" disabled="true") 
            %button(dojoType="dijit.form.Button" id="site00_voeis_site_submit" name="commit" value="Save Site" disabled="true") 
              Save Site
              %script{:type=>"dojo/method", :event=>"startup"}
                :plain
                  //var form = dijit.byId("site00_vertical_datum_form");
                  if('site00'.slice(-2)=='00') return;
                  var SRfrom = '';
                  var form0 = 'site00-edit-form';
                  var form = dijit.byId(form0);
                  console.log('INIT-FORM:',form0,form);
                  form0 = form.domNode;
                  //var pane = dijit.byNode(dojo.byId('site00'));
                  //eval('var pane = site00ref');
                  var pane = window['site00ref']
                  var site = pane.site;
                  console.log('GO PANE_UPDATE:',pane);
                  //INITIALIZE PANE: drop-downs, etc...
                  pane_update(pane);
                  //INITIALIZE: submit button
                  if(!pane.newSite) this.attr("disabled", !form.validate());
                  //this.attr("disabled", !this.isValid());
                  //form0.elements['site_name'].focus();
                  dijit.byId('site00_name').focus();
                  //IS FORM VALID?
                  console.log('FORM-CONNECT: '+site.id);
                  //###ON-STATE-CHANGE
                  this.connect(form, "onValidStateChange", function(state){
                    //console.log('formStateChange:',state);
                    this.attr("disabled", !state);
                  });
                  //###ON-SUBMIT
                  this.connect(this, "onClick", function(){
                    console.log('CREATE SITE: '+site.id);
                    //###SCROLL TO TOP
                    //window.scrollTo(0,0);
                    $('html #main_container').animate({scrollTop:0}, 'slow');//IE, FF
                    $('body #main_container').animate({scrollTop:0}, 'slow');//chrome, don't know if safary works
                    //var lat_long_datum_dd = drop_down(form,'site_lat_long_datum');
                    //var vertical_datum_dd = drop_down(form,'site_vertical_datum');
                    //var local_projection_dd = drop_down(form,'site_local_projection');
                    //console.log(vertical_datum_dd, local_projection_dd);
                    //vertical_datum_id:form.elements['site_vertical_datum'].options[form.elements['site_vertical_datum'].selectedIndex], 
                    //local_projection_id:form.elements['site_local_projection'].value
                    var data = {site:{
                      name:form0.elements['site_name'].value, 
                      code:form0.elements['site_code'].value, 
                      latitude:form0.elements['site_latitude'].value, 
                      longitude:form0.elements['site_longitude'].value, 
                      elevation_m:form0.elements['site_elevation_m'].value, 
                      local_x:form0.elements['site_local_x'].value, 
                      local_y:form0.elements['site_local_y'].value, 
                      pos_accuracy_m:form0.elements['site_pos_accuracy_m'].value, 
                      state:form0.elements['site_state'].value, 
                      county:form0.elements['site_county'].value, 
                      comments:form0.elements['site_comments'].value, 
                      description:form0.elements['site_description'].value,
                      provenance_comment:form0.elements['site_provenance_comment'].value, 
                      lat_long_datum_id:pane.local.lat_long_datum_dd.element.value,
                      vertical_datum_id:pane.local.vertical_datum_dd.element.value,
                      local_projection_id:pane.local.local_projection_dd.element.value
                    }};
                    console.log('LatLongDatum ID:',pane.local.lat_long_datum_dd.value,pane.local.lat_long_datum_dd.text());
                    console.log('VerticalDatum ID:',pane.local.vertical_datum_dd.value,pane.local.vertical_datum_dd.text());
                    console.log('LocalProjection ID:',pane.local.local_projection_dd.value,pane.local.local_projection_dd.text());
                    //lat_long_datum:lat_long_datum_dd.text, 
                    //vertical_datum:vertical_datum_dd.text,
                    //local_projection:local_projection_dd.text
                    if(pane.newSite) {
                      //###NEW SITE
                      $.post('/projects/#{@project.id}/sites.json', data, function(newValue) {
                        var newId = parseInt(newValue.id);
                        console.log('NEW ID: '+newId, newValue);
                        data['site']['id'] = newId;
                        //opt = fld.options[fld.selectedIndex];
                        data['site']['lat_long_datum'] = pane.local.lat_long_datum_dd.text();
                        data['site']['vertical_datum'] = pane.local.vertical_datum_dd.text();
                        data['site']['local_projection'] = pane.local.local_projection_dd.text();
                        console.log('LatLongDatum ID:',data.site.lat_long_datum_id,data.site.lat_long_datum);
                        console.log('VerticalDatum ID:',data.site.vertical_datum_id,data.site.vertical_datum);
                        console.log('LocalProjection ID:',data.site.local_projection_id,data.site.local_projection);
                        pane.siteSave(data['site']);
                        //dojo.publish('voeis/project/siteTables/refresh');
                        dojo.publish('voeis/project/site/close',[0]);
                        dojo.publish('voeis/project/site/select',[newId]);
                        //if(add_sample_menu.disabled) add_sample_menu.set('disabled',false);
                        //if(add_logger_menu.disabled) add_logger_menu.set('disabled',false);
                        add_sample_menu.set('disabled',false);
                        add_logger_menu.set('disabled',false);
                      });
                    } else {
                      //###UPDATE SITE
                      //data['site']['id'] = siteId;
                      data['site']['id'] = site.id.toString();
                      //save//$.post('#{@root_url}/projects/b6db01d0-e606-11df-863f-6e9ffb75bc80/sites/'+siteId,{site:{id:''+siteId, name:form.elements['site_name'].value, code:form.elements['site_code'].value, latitude:form.elements['site_latitude'].value, longitude:form.elements['site_longitude'].value, lat_long_datum_id:form.elements['site_lat_long_datum_id'].value, elevation_m:form.elements['site_elevation_m'].value, vertical_datum_id:form.elements['site_vertical_datum_id'].value, local_x:form.elements['site_local_x'].value, local_y:form.elements['site_local_y'].value, local_projection_id:form.elements['site_local_projection_id'].value, pos_accuracy_m:form.elements['site_pos_accuracy_m'].value, state:form.elements['site_state'].value, county:form.elements['site_county'].value, comments:form.elements['site_comments'].value, description:form.elements['site_description'].value}});
                      //$.post('#{@root_url}/projects/#{@project.id}/sites/'+siteId, data);
                      //$.post('/projects/#{@project.id}/sites/'+siteId+'.json', data);
                      $.ajax({
                        type: 'PUT',
                        url: '/projects/#{@project.id}/sites/'+site.id,
                        data: data,
                        success: '',
                        dataType: 'json'
                      });
                      data['site']['lat_long_datum'] = pane.local.lat_long_datum_dd.text();
                      data['site']['vertical_datum'] = pane.local.vertical_datum_dd.text();
                      data['site']['local_projection'] = pane.local.local_projection_dd.text();
                      console.log('UPDATE>>>',data);
                      console.log('LatLongDatum ID:',data.site.lat_long_datum_id,pane.local.lat_long_datum_dd);
                      console.log('VerticalDatum ID:',data.site.vertical_datum_id,pane.local.vertical_datum_dd);
                      console.log('LocalProjection ID:',data.site.local_projection_id,pane.local.local_projection_dd);
                      pane.siteSave(data['site']);
                      //dojo.publish('voeis/project/siteTables/refresh');
                      dojo.publish('voeis/project/map/clear',[site.id]);
                    };
                    return false;
                  });
                
            &nbsp;&nbsp;
            -#%button(dojoType="dijit.form.Button" onclick="console.log('CANCEL!');$('#edit-site00').hide();$('#show-site00').show();") 
            -#%button(id="site00_voeis_cancel" dojoType="dijit.form.Button") Cancel
            %button(dojoType="dijit.form.Button" id="site00_voeis_cancel" value="Cancel" onclick="cancel_site_form($$$id$$$);") Cancel
            -#&nbsp;&nbsp;
            -#= link_to('Cancel', 'javascript:', :class=>'icon icon-cancel', :onclick=>"$('#edit-site00').hide();$('#show-site00').show();") 
            -#= link_to('TEST', 'javascript:', :class=>'icon icon-cancel', :onclick=>"dijit.byNode(dojo.byId('site00')).siteFormSave(this);") 
            -#%input{:type=>"button", :value=>"TEST", :onclick=>"dijit.byNode(dojo.byId('site00')).siteFormSave(this.form);"}
            -#= link_to('Cancel', '#', :class=>'icon icon-cancel', :onclick=>'window.history.back();return false;') 


%br{:style=>'float:none; clear:both;'}
