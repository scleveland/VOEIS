-# content_for(:javascripts) do
:javascript
  function #{tab_id}_createDataSet(){ 
    var els = dojo.byId("#{tab_id}_data_set").elements;
    var qstr = "name="+els.name.value+"&description="+els.description.value+"&type="+els.type.value+"&api_key=#{User.current.api_key}";
    $.post("#{root_url}projects/#{project_uid}/apivs/create_project_data_set.json?"+qstr,
    function(data) {
      $('##{tab_id}_data_set_select').append($("<option></option>").attr("value",data['id']).text(els.name.value)); 
      $('##{tab_id}_data_set_select').val(data['id']);
      dijit.byId("#{tab_id}_new_data_set").hide();
    });
  }
  dojo.require("dijit.Tooltip");

%div{:id=>"#{tab_id}_new_data_set", :dojoType=>"dijit.Dialog", :title=>"New Data Set"}
  %h3 Create a new Data Set:
  = form_for :data_set, :html=>{:dojoType=>"dijit.form.Form", :id=>"#{tab_id}_data_set"} do |f|
    %label Name:
    =clear_break    
    %input{:type=>"text", :name=>"name", :dojoType=>"dijit.form.ValidationTextBox", :size=>30,  :style=>"width:30em", :required=>"true", :invalidMessage=>"A DataSet Name is required."}
    =clear_break      
    =clear_break 
    %label Description:
    %br
    -#=f.text_area :description, :cols=> 30, :rows => 3
    %input{:type=>"text", :name=>"description", :size => 30, :style=>"width:30em",:dojoType=>"dijit.form.TextBox"}
    =clear_break
    =clear_break
    %label Type:
    %br
    %input{:type=>"text", :name=>"type", :size => 30, :style=>"width:30em",:dojoType=>"dijit.form.TextBox"}
    =clear_break
    =clear_break 
    %br
    %button{:dojoType=>"dijit.form.Button", :title=>'Create', :onClick=>"#{tab_id}_createDataSet();"}
      Create Data Set
      %script{:type=>"dojo/method", :event=>"startup"}
        var form = dijit.byId("#{tab_id}_data_set");
        // set initial state
        this.attr("disabled", !form.isValid());
        this.connect(form, "onValidStateChange", function(state){
        this.attr("disabled", !state);
        });